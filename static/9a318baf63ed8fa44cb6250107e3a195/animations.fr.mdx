---
title: "Animations"
description: "Les animations et jeux vid√©o"
---

# i) Les animations et jeux vid√©o

<InternalPageMenu>
  <PathViewer>
    <PathViewerItem to="/"> web2course </PathViewerItem>
    <PathViewerItem to="/part2"> Partie 2 </PathViewerItem>
    <PathViewerItem selected> i) Les animations et jeux vid√©o </PathViewerItem>
  </PathViewer>
  <InternalPageMenuItem> üç¨ Animations via l'API Canvas </InternalPageMenuItem>
  <InternalPageMenuItem> üç¨ Animations via une librairie externe </InternalPageMenuItem>
  <InternalPageMenuItem> Exercice 2.13 : Gestion d'√©v√©nements associ√©s √† une animation </InternalPageMenuItem>
  <InternalPageMenuItem> üç¨ Jeux vid√©o en 2D via Phaser </InternalPageMenuItem>
  <InternalPageMenuItem> Projet 2.14 : animation </InternalPageMenuItem>
</InternalPageMenu>

# <InternalPageTitle> üç¨ Animations via l'API Canvas </InternalPageTitle>

L'API Canvas offerte par le browser permet de cr√©er des animations (2D ou 3D) √† l'aide de JS et de l'√©l√©ment HTML **`<canvas>`**.

Il existe d'autres API fournies par le browser pour dessiner dans un browser qui ne seront pas vues dans ce cours : WebGL, SVG DOM Interface...

Voici les √©tapes pour cr√©er une animation √† l'aide de l'API Canvas :

1. Ajout d'un √©l√©ment **`<canvas>`** dans votre HTML et acc√®s √† cet objet via du JS ;  
*Voici un exemple o√π l'on cr√©e un √©l√©ment **`canvas`** dans le main d'**`index.html`** √† l'aide de JS* :
```js
const main = document.querySelector('main');  
main.innerHTML = '<canvas />';
const canvas = document.querySelector('canvas');
```

2. Si n√©cessaire, d√©finition du style du **`canvas`** et √©ventuellement du **`body`** √† l'aide de CSS, Bootstrap ou autres, ou directement du JS.  
*Voici un exemple o√π l'on g√®re la taille du canvas via du JS* :
```js
const main = document.querySelector('main');
const mainWidth = main.clientWidth;
const mainHeight = main.clientHeight;
const canvas = document.querySelector('canvas');
canvas.width = mainWidth;
canvas.height = mainHeight;
```

3. Acc√®s au contexte de rendu du canvas pour pouvoir dessiner dessus en 2D en utilisant les **Canvas API**.  
*Voici un exemple o√π l'on dessine un carr√© de couleur bleue √† une position al√©atoire dans le main :*
```js
const DEFAULT_COLOR = 'blue';
const main = document.querySelector('main');
const mainWidth = main.clientWidth;
const mainHeight = main.clientHeight;
const canvas = document.querySelector('canvas');
canvasContext = canvas.getContext('2d');
canvasContext.fillStyle = DEFAULT_COLOR;
canvasContext.fillRect(Math.random() * mainWidth, Math.random() * mainHeight, 20, 20);
```

4. Cr√©ation d'une animation en affichant successivement des "frames".  
*On pourrait appeler la fonction **`setInterval`**, n√©anmoins cette fonction n'est pas optimis√©e pour s'assurer que le browser a les ressources pour effectuer les appels p√©riodiques demand√©s.  On utilise donc la fonction **`window.requestAnimationFrame(callback)`** qui permet d'appeler une **`callback`** environ 60 fois / s, quand le browser est pr√™t. Voici la structure du code JS qui permet de cr√©er une animation √† l'aide des Canvas API :*
```js
requestAnimationFrame(drawOneFrame);
function drawOneFrame() {
  // 1. clear de canvas
  // 2. draw the current frame   
  // 3. refresh¬†automatically¬†the¬†animation¬†via¬†a¬†recursive¬†call
¬† requestAnimationFrame(drawOneFrame);
}
```

## Exemple d'animation
Nous vous offrons un exemple d'animation faite √† l'aide des Canvas API : [canvas](https://github.com/e-vinci/js-demos/tree/main/frontend/canvas).  

N'h√©sitez pas √† ex√©cuter cette application et √† comprendre le code associ√©. Ce code va √™tre utilis√© pour un prochain exercice.

# <InternalPageTitle> üç¨ Animations via une librairie externe </InternalPageTitle>

Il existe de nombreuses librairies JS animant diff√©rentes propri√©t√©s :  CSS, attributs DOM, objets JS, SVG...

Voici quelques librairies Open Source que nous recommandons :
- Pour les animations 2D : [anime](https://animejs.com/)
- Pour les jeux en 2D : [Phaser](https://phaser.io/)
- Pour les animations 3D : [three.js](https://threejs.org/)

Il existe aussi une librairie commerciale qui reste n√©anmoins int√©ressante : [GreenSock](https://greensock.com/).

Si vous souhaitez utiliser les librairies recommand√©es pour cr√©er des animations, vous avez les connaissance en JS suffisante pour le faire par vous-m√™me, √† l'aide de la documentation propos√©e sur le site de la librairie que vous choisiriez.

Le truc concernant les animations, c'est d'avancer pas √† pas, et de r√©fl√©chir √† ce que vous souhaitez faire en terme d'objectifs fonctionnels.  

Imaginez que nous souhaitons faire une animation qui mette √† disposition un mot tournant comme une h√©lice : 
- Ce mot doit tourner comme une h√©lice au passage de la souris sur le mot. 
- En cliquant sur la fl√®che haut ou bas du clavier, l'h√©lice doit monter ou descendre.
- En cliquant sur le mot, celui-ci doit :
  - arr√™ter de tourner
  - se mettre √† grandir puis rapetissir.

Fonctionnellement, ce que nous souhaitons faire semble clair.

Maintenant, √† l'aide d'√©l√©ments HTML, de propri√©t√©s CSS, et de JS, comment pourrions nous aborder ce probl√®me ?

- Nous avons besoin d'une h√©lice qui tourne. Nous allons probablement pouvoir utiliser une **`div`** pour cela qui prendra la largeur du mot.  
*Dans le code associ√©, nous pourrions identifier cette balise par l'id **`propeller`***.
- Nous avons besoin de faire monter ou descendre notre h√©lice. Pourquoi ne pas utiliser une nouvelle **`div`** qui fera office d'ascenseur, et qui contiendra notre h√©lice.  
*Dans le code associ√©, nous pourrions identifier cette balise par l'id **`lift`***.
- Ensuite, il reste √† g√©rer des √©couteurs d'√©v√©nements sur le clavier, et sur ces divs. Il serait pratique d'utiliser une librairie d'animation 2D pour faciliter les mouvements de l'h√©lice.

La suite montre comment cela a √©t√© impl√©ment√© √† l'aide de la librairie **`anime.js`**.

## Exemple d'animation √† l'aide d'anime.js

Nous vous offrons un exemple d'animation faite √† l'aide d'**anime** : [anime](https://github.com/e-vinci/js-demos/tree/main/frontend/anime) pour impl√©menter un mot qui tourne comme une h√©lice.  

N'h√©sitez pas √† ex√©cuter cette application et √† comprendre le code associ√©.

Voici quelques explications :
- Nous avons statiquement impl√©ment√© la structure de l'h√©lice et de l'ascenseur dans le fichier **`index.html`** :

 ```html 
<div id="lift">
  <!-- d-inline-block allow to wrap the div to the width of its content -->
  <div class="text-center bg-secondary d-inline-block" id="propeller">
    XXX<a href="#" class="btn btn-primary" id="message">Welcome</a>XXX
  </div>
</div>
 ```

- Nous avons install√© **anime.js** et appris √† l'utiliser gr√¢ce √† la documentation https://github.com/juliangarnier/anime/ :
    - **Installation** :  
    ```bash
    npm i animejs
    ```
    - **Utilisation de la librairie** dans un module :  
    ```js
    import anime from 'animejs/lib/anime.es.js';
    ```
- On utilise la fonction **`anime`** pour r√©aliser les animations que l'on cible aux **`div`** via leur **`id`** dans la propri√©t√© **`targets`**.

# <InternalPageTitle> Exercice 2.13 : Gestion d'√©v√©nements associ√©s √† une animation </InternalPageTitle>

Veuillez adapter une application web permettant l'affichage de diff√©rents scintillements de formes selon la demande de l'utilisateur.

Veuillez cr√©er un nouveau projet dans votre repository local et votre web repository (normalement appel√© **`web2`**) nomm√© **`/exercises/2.13`** en copiant/collant le code √† adapter se trouvant dans ce dossier (du repo associ√© aux tutoriels & d√©mos) : [/demo/canvas](https://github.com/e-vinci/js-demos/tree/main/frontend/canvas).

Veuillez retravailler l'animation pour que :
-	elle s'arr√™te ou d√©marre lors d'un clic gauche d'un utilisateur ;
-	les carr√©s grandissent ou rapetississent au clic sur la touche **`+`** ou la touche **`-`** ; 
-	lors d'un clic droit de la souris, la couleur des carr√©s change de mani√®re al√©atoire.

Quand votre application est finalis√©e, veuillez faire un **`commit`** de votre code avec comme message : **`2.13 : canvas event management`**.

#### ü§ù Tips
-	N'h√©sitez pas √† d√©couvrir la documentation de **`requestAnimationFrame()`** pour voir comment stopper une animation.  
Toujours pas d'id√©e ? N'h√©sitez pas √† utiliser la fonction **`cancelAnimationFrame()`**.
-	Vous pouvez utiliser le type d'√©v√©nement **`contextmenu`** pour g√©rer les clics droits. Plus d'info dans la [documentation de MDN](https://developer.mozilla.org/en-US/docs/Web/API/Element/contextmenu_event)
-	Vous pouvez √©couter le type d'√©v√©nement **`keydown`** sur l'objet **`document`** pour g√©rer l'appui sur les touches **`+`** ou **`-`**.  
Plus d'info dans la [documentation de MDN](https://developer.mozilla.org/en-US/docs/Web/API/Document/keydown_event).
-	Si vous avez besoin de g√©n√©rer un nombre al√©atoire de 0 √† 255 : 
```js
Math.floor(Math.random() * 256); // [0,255]
```

# <InternalPageTitle> üç¨ Jeux vid√©o en 2D via Phaser </InternalPageTitle>

## Introduction
Si vous souhaitez cr√©er un jeu vid√©o en 2D pour des browsers, nous vous conseillons la librairie [Phaser](https://phaser.io/).

## Cours de Phaser offert
Rudi Giot, un incroyable enseignant √† l'ISIB (HE2B), met g√©n√©reusement √† notre disposition son cours nomm√© "Phaser - Jeux vid√©o 2D" : https://github.com/RudiGiot/Phaser.

La derni√®re version du Syllabus au format pdf est disponible ici : <LinkFile name="Phaser.pdf" target="_blank" download>Phaser - Jeux vid√©o 2D en Javascript</LinkFile>.

## Boilerplate pour r√©aliser un jeu Phaser √† l'aide de Webpack
Il n'est pas simple d'int√©grer Phaser au sein de Webpack et des outils de d√©veloppement offerts dans ce cours de JS. Cela peut prendre plusieurs jours avant d'obtenir une bonne configuration, ce qui peut vite devenir frustrant.

Nous vous offrons donc un boilerplate si vous souhaitez cr√©er un jeu vid√©o Phaser en utilisant les outils modernes mis en place dans ce cours :  [js-phaser-boilerplate](https://github.com/e-vinci/js-phaser-boilerplate).

Pour information, la source de la configuration de Webpack provient principalement de [Phaser 3 Webpack Project Template](https://github.com/photonstorm/phaser3-project-template).  
Le jeu pr√©sent√© dans le boilerplate est bas√© sur le tutoriel nomm√© [Modern JavaScript Phaser 3 Tutorial : Part 1 to Part 5](https://blog.ourcade.co/posts/2020/make-first-phaser-3-game-modern-javascript-part1/) et utilise Webpack au lieu de Parcel comme module bundler.

# <InternalPageTitle> Projet 2.14 : animation </InternalPageTitle>

Veuillez enrichir le frontend de votre projet en d√©veloppant une animation 2D, 3D ou un jeu vid√©o en utilisant une librairie externe. Nous vous conseillons d'utiliser une des librairies propos√©es sur cette page, n√©anmoins, vous pouvez tenter d'utiliser d'autres librairies.

Dans un premier temps, identifiez ce qui pourrait √™tre rendu interactif, ce qui aurait du sens. 
Si par exemple votre projet offre un quizz, alors il serait int√©ressant d'avoir une animation si le score est bon, et une autre animation si le score est mauvais.

Une fois que vous avez une bonne id√©e de ce que vous souhaitez animer, du comportement fonctionnel attendu, vous devez s√©lectionner une librairie externe pour le faire (**anime.js**, **three.js**...).

Veuillez repartir du code de [Projet 2.12](../routing/#projet_2_12_navigation_router).  
Le code de votre application doit se trouver dans votre repository local et votre web repository (normalement appel√© **`web2`**) dans le r√©pertoire nomm√© **`/project/2.14`**.

<UnAuthenticatedBlock>

Si vous avez choisi comme projet de travailler sur l'application **`myMovies`**, vous pourriez commencer par cr√©er une simple animation √† l'aide de la librairie anime.js pour rendre votre **`HomePage`** attractive.

</UnAuthenticatedBlock>

<AuthenticatedBlock>

Veuillez travailler avec les membres de votre groupe.  
S'il y a plusieurs animations √† d√©velopper pour votre projet, il est int√©ressant de vous partager le travail.  
N'h√©sitez pas √† soit chacun coder un prototype de l'application, soit en pair programming, soit √† 3-4-5 √©tudiants, selon vos go√ªts. 

Au cours de la s√©ance, vos enseignants vous inviteront :
- √† identifier les technologies appropri√©es pour vos animations ;
- √† discuter de vos choix technologiques ; 
- √† identifier comment vous allez apprendre la nouvelle technologie (**anime.js**, **three.js**...) et d√©velopper vos animations.

Quand vous travaillez sur le code de votre projet, vous pouvez aussi directement travailler sur le web repo de votre groupe. N√©anmoins, il peut √™tre int√©ressant de d'abord fournir un prototype d'animation dans votre web repo personnel au sein de **`/project/2.14`**.

</AuthenticatedBlock>

Quand un prototype d'animation est finalis√©, veuillez faire un **`commit`** de votre code avec comme message : **`2.14 : animation`**.