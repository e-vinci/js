---
title: "Outils API"
description: "Am√©lioration des outils de d√©veloppement"
---

# c) Am√©lioration des outils de d√©veloppement

<InternalPageMenu>
  <PathViewer>
    <PathViewerItem to="/"> web2course </PathViewerItem>
    <PathViewerItem to="/part1"> Partie 1 </PathViewerItem>
    <PathViewerItem selected> c) Tools </PathViewerItem>
  </PathViewer>
  <InternalPageMenuItem> Red√©marrage automatique au changement d'un fichier </InternalPageMenuItem>
  <InternalPageMenuItem> Debugging d'une API </InternalPageMenuItem>
  <InternalPageMenuItem> Autres outils de d√©veloppement : le linter & le formatter </InternalPageMenuItem>
  <InternalPageMenuItem> Exercice 1.8 : Refactoring √† l'aide de linter & formatter </InternalPageMenuItem>
</InternalPageMenu>

Dans le d√©veloppement de nos API, nous souhaitons plus de d'outil pour faciliter nos t√¢ches de d√©veloppeurs.  
Notamment, √† chaque changement de notre code, nous ne souhaitons pas devoir red√©marrer manuellement notre application.

Nous souhaiterions aussi b√©n√©ficier d'un debugger et d'autres outils, comme un linter...


# <InternalPageTitle> Red√©marrage automatique au changement d'un fichier </InternalPageTitle>

<div className="card card__simple-youtube-container">
    <YoutubeImage src="https://youtu.be/SNGoExEk1CQ" />
</div>

## Configuration de l'utilisation de nodemon

Il est possible de faire en sorte qu'√† chaque fois que nous sauvons un fichier, notre application **`node.js`** red√©marre automatiquement.

Voici la pr√©c√©dure :

- Installez **nodemon** au niveau du r√©pertoire du projet :

```bash
npm i nodemon -D
```

- Pour lancer **nodemon** (au lieu du simple **node**) quand on tape **`npm run dev`** : Veuillez ajouter la ligne **`"dev": "nodemon /bin/www"`** dans **`package.json`** :

```json highlighting="2"
"scripts": {
    "dev": "nodemon ./bin/www",
    "start": "node ./bin/www"
  },
```

## Configuration des fichiers √† ignorer pour √©viter des r√©d√©marrages

Il est possible d'indiquer les fichiers qui doivent √™tre ignor√©s par **nodemon** via l'ajout dans **`package.json`** :

```json
"nodemonConfig": {
    "ignore": [
      "data/*"
    ]
  },
```

Dans la configuration ajout√©e ci-dessous, tous les fichiers qui seraient mis √† jour dans le r√©pertoire **`/data`** ne provoqueront pas de red√©marrage du serveur **nodemon** lorsqu'il est lanc√© (en mode 'dev').

Veuillez installer **nodemon** dans le cadre de votre tutoriel en cours (**api-persistence**) et configurer celui-ci pour que l'application ne red√©marre pas √† chaque fois que vous cr√©ez une nouvelle pizza.   
N'h√©sitez pas √† tester la cr√©ation d'une pizza avant de dire √† **nodemon** d'ignorer les fichiers se trouvant dans **`/data`**.

# <InternalPageTitle> Debugging d'une API </InternalPageTitle>

<div className="card card__simple-youtube-container">
    <YoutubeImage src="https://youtu.be/LV3LOWoaFaU" />
</div>

## Introduction

Est-ce que nous pouvons utiliser VS Code pour d√©bugger notre API ?  
Oui, heureusement, car le debugger est probablement le meilleur ami des d√©veloppeurs.

Il est toujours l√† pour aider, √† l'√©coute de nos investigations, mettant r√©guli√®rement en lumi√®re des pistes de sortie de probl√®mes, tout cela de mani√®re bienveillante, sans jamais nous brusquer üòÅ.

[Debugging via VS Code](https://code.visualstudio.com/docs/editor/debugging) [[R.59]](/references/#r59) fournit le d√©tails de comment d√©bugger sous VS Code. Nous vous offrons par la suite une fa√ßon pratique de rapidement d√©bugger.

## Debugging sans configuration

Sans aucune configuration, il est possible de d√©bugger une application **Node.js**.

Il suffit d'ouvrir le script d'entr√©e de votre application dans VS Code. Pour une application Express, le script d'entr√©e est **`/bin/www`**. Cliquez dans l'Explorer de VS Code sur **`/bin/www`** de votre tutoriel **api-persistence**. Une fois le script **`/bin/www`** ouvert, il ne reste plus qu'√† ex√©cuter le **Debug**.  
Pour ce faire :
- soit vous cliquez sur l'ic√¥ne **`Run and Debug`** √† gauche de l'Explorer, puis sur le bouton "**`Run and Debug`**";
- soit vous cliquez sur "**`Run`**" puis sur "**`Start Debugging`**";
- soit vous cliquez sur "**`F5`**",
- Il est probable que la premi√®re fois que vous lancez le **`Debug`**, vous devrez s√©lectionner **`Node.js`**   (il sera indiqu√© : "**`Select debugger`**") comme debugger dans une liste.

Une fois le debugger lanc√©, il suffit d'ajouter des breakpoints dans le code source et d'ex√©cuter le code pas √† pas.

N'h√©sitez pas √† ex√©cuter pas √† pas une op√©ration de votre api, comme la cr√©ation d'une pizza par exemple.

## Debugging avec une bonne configuration

Trouver une configuration qui permette de bien d√©bugger n'est pas si ais√©. Nous allons donc voir ensemble comment mettre en place une configuration des plus utiles dans le cadre de ce cours.

Premi√®rement, il est important que lorsqu'on lance le debugger, on puisse b√©n√©ficier de **nodemon** et des red√©marrages automatiques en cas de changement de code.  
Pour ce faire, veuillez mettre √† jour le fichier **`packages.json`** pour rajouter un script de d√©marrage :

```json highlighting="2"
"scripts":¬†{
¬†¬†¬†¬†"debug":¬†"nodemon¬†./bin/www",
¬†¬†¬†¬†"dev":¬†"nodemon¬†./bin/www",
¬†¬†¬†¬†"start":¬†"node¬†./bin/www"
¬†¬†},
```

Nous allons maintenant cr√©er une configuration de debugging associ√©e √† notre repo **web2** :

- Cliquez sur l'ic√¥ne "**`Run and Debug`**" √† gauche de l'Explorer, puis sur le lien "**`create launch.json file`**" (**`.vscode/launch.json`**).
- Quand il sera indiqu√© "**`Select debugger`**", s√©lectionnez **`Node.js`**.  
  NB : Peu importe le debugger que vous s√©lectionnez, car vous allez par la suite copier / coller la configuration propos√©e.
- Une fois le debugger **`Node.js`** choisi, VS Code cr√©e un r√©pertoire **`.vscode`** √† la racine du folder ouvert au sein de VS Code (normalement vous devriez avoir ouvert votre repo local **web2**) contenant un fichier **`launch.json`** et une configuration initiale. Veuillez remplacer le contenu de ce fichier (**`.vscode/launch.json`**) par celui-ci :

```json highlighting="10-14,19"
{
  // Use IntelliSense to learn about possible attributes.
  // Hover to view descriptions of existing attributes.
  // For more information, visit: https://go.microsoft.com/fwlink/?linkid=830387
  "version": "0.2.0",
  "configurations": [
    {
      "name": "Launch via NPM",
      "request": "launch",
      "runtimeArgs": ["run-script", "debug"],
      "runtimeExecutable": "npm",
      "skipFiles": ["<node_internals>/**"],
      "type": "pwa-node",
      "cwd": "${fileDirname}"
    }
  ]
}
```

**`runtimeArgs`** permet de s√©lectionner le script √† lancer par le debugger, √† savoir ici : **`debug`**.  
Ainsi, quand on lancera le debugger, celui-ci lancera le programme avec l'√©quivalent de la commande **`npm run debug`**.

**`"cwd":"${fileDirname}"`** : **`cwd`** permet d'indiquer le chemin vers la racine du programme √† d√©bugger. La variable **`fileDirname`** permet de s√©lectionner le programme √† d√©bugger sur base du fichier ouvert et actif dans VS Code.

Si vous avez plusieurs applications au sein d'un folder de VS Code, pour d√©bugger une application en particulier, nous vous conseillons cette approche :
- Ouvrez le fichier **`package.json`** de l'application √† d√©bugger ;
- Cliquez sur l'ic√¥ne **`Run and Debug`** √† gauche de l'Explorer, puis cliquez sur **`Start Debugging`** (ou cliquez juste sur **`F5`**) en v√©rifiant que la configuration de debugging s√©lectionn√©e est bien nomm√©e **`Launch via NPM`**.

Notons que le nom de la configuration de debugging peut facilement √™tre modifi√©e en changeant la valeur de l'attribut **`name`** dans **`/.vscode/launch.json`**.

Veuillez tester cette configuration de debugging au sein de votre repo local **web2**.  
Vous pourriez par exemple observer pas √† pas une op√©ration de suppression d'une pizza, afin de voir √† quel moment le contenu de l'array **`pizzas`** est mis √† jour, ainsi que le fichier **`/data/pizzas.json`**.

Si tout fonctionne bien, faites un **`commit`** de votre repo (**`web2`**) avec comme message : **`api-persistence tutorial`**.

En cas de souci, vous pouvez acc√©der au code du tutoriel ici :
[api-persistence](https://github.com/e-vinci/js-demos/tree/main/backend-restful-api/restful-api-essentials/persistence).

# <InternalPageTitle> Autres outils de d√©veloppement : le linter & le formatter </InternalPageTitle>

<div className="card card__simple-youtube-container">
    <YoutubeImage src="https://youtu.be/BiWa7bbnjTI" />
</div>

## Introduction

Il serait utile de b√©n√©ficier :

- d'un **linter** : celui-ci devrait imposer un "style guide" qui sera √©quivalent √† notre style de programmation pour les IHM.
- d'un **formatter** : celui-ci devrait automatiquement permettre d'am√©liorer le style de notre code pour se rapprocher de ce qui est impos√© par le linter.

Un boilerplate a √©t√© cr√©√© afin de mettre en place ces outils :
[basic-api-boilerplate](https://github.com/e-vinci/basic-api-boilerplate)

**Vous ne devez pas savoir comment cr√©er et configurer un tel boilerplate.**  
N√©anmoins, pour les personnes tr√®s curieuses, la cr√©ation du boilerplate est expliqu√©e dans le **`README`** du boilerplate.

Pour la suite du cours, nous n'utiliserons plus le g√©n√©rateur d'application Express, mais ce boilerplate.

Il est important d'avoir install√© les extensions **`ESLint`** et **`prettier`** au sein de VS Code pour bien utiliser le boilerplate d'une API.  

## Le linter
Nous souhaitons ajouter un outil qui permette de d√©tecter des erreurs de programmation lors de l'√©criture de nos scripts, un linter.   
Nous voulons que le linter impose le style d'Airbnb d√©crit dans le **Airbnb JS style guide**.   
Pour ce faire, gr√¢ce au boilerplate, lorsque nous lan√ßons la commande **`npm start`**, nous utilisons **ESLint** (cet outil est aussi utilis√© par Facebook au sein d'applications React) qui impose un style de programmation conforme aux r√®gles d'Airbnb.   
Lors du build de l'application, nous b√©n√©ficions de feedback sur notre code.

Pour b√©n√©ficier de plus de feedback sur le code, veuillez installer l'extension **ESLint** au sein de VS Code.    
Vous ne devez plus attendre le build pour avoir du feedback sur votre code, cela se fait d√®s l'√©criture ! Vous avez m√™me des propositions de "Quick fix" !

Pour votre info, la configuration des r√®gles de **ESLint** se fait dans le fichier **`.eslintrc.js`** devant se trouver √† la racine d'un projet et offert au sein du boilerplate.

## Le formatter
Pour formater facilement votre code, le boilerplate fournit une configuration de **prettier** conforme √† ce qui est attendu pour s'approcher du style impos√© par le linter, c'est √† dire au style d'Airbnb.

Pour que la configuration du formater offerte dans le boilerplate soit utile, veuillez installer l'extension **prettier** au sein de VS Code.

Une fois **prettier** install√© dans VS Code, vous pouvez facilement formatter votre code conform√©ment au style d'Airbnb :
- soit en tapant **`Shift Alt F`** ;
- soit en faisant un **clic droit** sur votre script, **`Format Document`** ; la premi√®re fois, il se peut que vous deviez s√©lectionner **prettier** comme formatter.

Pour votre info, la configuration des r√®gles de **prettier** se fait dans le fichier **`.prettierrc.js`** devant se trouver √† la racine d'un projet et offert au sein du boilerplate.


# <InternalPageTitle> Exercice 1.8 : Refactoring √† l'aide de linter & formatter </InternalPageTitle>

Vous allez faire un refactor de la RESTful API de **myMovies** en utilisant les outils de d√©veloppement modernes mis √† disposition dans un boilerplate. Vous allez √©crire du code plus propre, qui correspond au style de programmation inpos√© par le le style d'Airbnb.

Veuillez cr√©er un nouveau projet dans votre repository local et votre web repository (normalement appel√© **`web2`**) nomm√© **`/exercises/1.8`** sur base du boilerplate : [basic-api-boilerplate](https://github.com/e-vinci/basic-api-boilerplate).

Veuillez reprendre le code que vous avez d√©velopp√© √† l'exercice pr√©c√©dent ([Exercice 1.7](../json/#exercice_1_7_persistance_des_donnees)) et int√©grez le dans votre nouveau projet. 

Vous devez mettre √† jour le code pour qu'il n'y ait plus d'erreur identifi√©e par le linter. Pour ce faire, vous devez utiliser le formatter.

‚ö° Si vous avez fait un clone du boilerplate, attention au Git dans le Git, n'oubliez pas de supprimer le dossier **`.git`** pr√©sent dans votre nouveau projet.

Veuillez tester que votre API fonctionne toujours aussi bien apr√®s le refactoring.

Veuillez faire un **`commit`** de votre code avec le message suivant : **`1.8 : API : linter & formatter`**.

#### ü§ù Tips 
- Tant que nous n'installez pas les packages, le linter n'est pas activ√© dans VS Code. Il faut aussi fermer et r√©ouvrir les fichiers une fois les packages install√©s pour que les erreurs de style apparaissent dans VS Code.  
- Vous avez un probl√®me du type "no such file or directory" ? N'h√©sitez pas √† cr√©er un chemin correct vers votre fichier JSON √† l'aide de la m√©thode **`join`** de l'objet **`path`** :
```js
const path = require('node:path');

const jsonDbPath = path.join(__dirname, '/../data/films.json');
```

- Vous pourriez avoir besoin de convertir une string vers un entier, par exemple : 
  - soit : **`const id = Number(req.params.id);`**
  - soit : **`const id = parseInt(req.params.id, 10);`**
 


